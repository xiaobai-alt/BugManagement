{% extends 'user/layout/manage_base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'user/plugin/editor-md/css/editormd.min.css' %}">
    <link rel="stylesheet" href="{% static 'user/plugin/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'user/plugin/bootstrap-select/css/bootstrap-select.min.css' %}">
{% endblock %}

{% block content %}
    <div class="container-fluid clearfix" style="padding: 20px 0;">
        <div class="col-sm-7">
            <div class="panel panel-default">
                <div class="panel-heading edit-heading">
                    <i class="fa fa-edit" aria-hidden="true"></i> 更新问题
                </div>
            </div>
            <div class="panel-body">
                <form id="editForm" class="form-horizontal" method="post">
                    {% csrf_token %}
                        <div class="form-group">
                            <label for="{{ form.issues_type.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.issues_type.label }}</label>
                            <div class="col-sm-10">
                                <div>
                                    {{ form.issues_type}}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.subject.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.subject.label }}</label>
                            <div class="col-sm-10">
                                <div>
                                    {{ form.subject}}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.module.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.module.label }}</label>
                            <div class="col-sm-10">
                                <div>
                                    {{ form.module}}
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.desc.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.desc.label }}</label>
                            <div class="col-sm-10">
                                <div>
                                    <div id="editor">
                                        {{ form.desc}}
                                    </div>
                                    <div class="error-msg"></div>
                                </div>
                                <div class="error-msg"></div>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-6 pd-0">
                                <label for="{{ form.status.id_for_label }}" class="col-md-4 control-label">{{ form.status.label }}</label>
                                <div class="col-md-8 clearfix">
                                    <div>
                                        {{ form.status }}
                                    </div>
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                            <div class="col-md-6 pd-0">
                                <label for="{{ form.priority.id_for_label }}" class="col-md-4 control-label">{{ form.priority.label }}</label>
                                <div class="col-md-8 clearfix">
                                    <div>
                                        {{ form.priority }}
                                    </div>
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-6 pd-0">
                                <label for="{{ form.assign.id_for_label }}" class="col-md-4 control-label">{{ form.assign.label }}</label>
                                <div class="col-md-8 clearfix">
                                    {{ form.assign }}
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                            <div class="col-md-6 pd-0">
                                <label for="{{ form.attention.id_for_label }}" class="col-md-4 control-label">{{ form.attention.label }}</label>
                                <div class="col-md-8">
                                    {{ form.attention }}
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-6 pd-0">
                                <label for="inputPassword3" class="col-md-4 control-label">开始时间</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-addon" id="sizing-addon2">
                                            <i class="fa fa-calendar" aria-hidden="true"></i>
                                        </span>
                                        {{ form.start_date }}
                                    </div>
                                    <span class="error-msg"></span>
                                </div>
                            </div>
                            <div class="col-md-6 pd-0">
                                <label for="inputPassword3" class="col-md-4 control-label">截止时间</label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-addon" id="sizing-addon2">
                                            <i class="fa fa-calendar" aria-hidden="true"></i>
                                        </span>
                                        {{ form.end_date }}
                                    </div>
                                    <span class="error-msg"></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-6 pd-0">
                                <label for="inputPassword3" class="col-md-4 control-label">模式</label>
                                <div class="col-md-8">
                                    <div>
                                        {{ form.mode }}
                                    </div>
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                            <div class="col-md-6 pd-0">
                                <label for="inputPassword3" class="col-md-4 control-label">父问题</label>
                                <div class="col-md-8">
                                    {{ form.parent }}
                                    <div class="error-msg"></div>
                                </div>
                            </div>
                        </div>
                </form>
            </div>
        </div>
    </div>


{% endblock %}

{% block js %}
    <script src="{% static 'user/plugin/editor-md/editormd.min.js' %}"></script>
    <script src="{% static 'user/plugin/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}"></script>
    <script src="{% static 'user/plugin/bootstrap-select/js/bootstrap-select.min.js' %}"></script>
    <script src="{% static 'user/plugin/bootstrap-select/js/i18n/defaults-zh_CN.min.js' %}"></script>
    <script src="{% static 'user/plugin/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js' %}"></script>
    <script>

        var WIKI_UPLOAD_URL = "{% url 'user:wiki_img_upload' project_id=request.bug_management.project.id %}";
        $(function () {
                initDatePicker();
                initEditorMd();
            });

        // 时间选择设置
        function initDatePicker() {
            $('#id_start_date,#id_end_date').datepicker({
                format: 'yyyy-mm-dd',
                startDate: '0',
                language: 'zh-CN',
                autoclose: true,
            });
        }

        //初始化markdown编辑器,将textare转换为markdown
        function initEditorMd() {
            editormd('editor', {
                placeholder:'请输入内容',
                height: 300,
                path: "{% static  'user/plugin/editor-md/lib/' %}",
                imageUpload:true,
                imageFormats:['jpg', 'jpeg', 'png', 'gif'],
                imageUploadURL:WIKI_UPLOAD_URL,
            });
        }


    </script>

{% endblock %}